#include <iostream>
#include <fstream>
#include <string>

int main() {
    const std::string cifra8Bits = "000001110000001110000001110000000110000000110000100110000100110000100110100100110100100100100100100100101100100101100100101100101101100111101100011101100011101110011101010011100010011100010011000010010000010010000010010000011010000001010000101010001101010001101010101101011101101001101101101101100101101110101101110101100110101100110101100110100100110110100110110100110110100100110100000110100000110110000110110000111110000111110000111110000111110010111110110111110110111110110111110110111110110111110110011110111011110101011110101011111101011111101011011101011011101001011101001011100001011110001011010001010010001000010001000010001000010011000010011000011011000011011000011011000011011000011011100011011100011011100011111100010111100000111100100111101100111111100111011100110011100110011100110011100110011100110011000110011000110001000110101000111101000101101000101101000101101000101101100101100100101100100101000100101000100101000100101000100101000100101000100101000100101010100101010100101010100101010100001010101001010111001010111001010111001010111001110111001110111001110111101110111101110101101110001101111001101111001101111001101111001101111001101111001101111011101111111101111111101111111101011111101011111101011111001011111001011111001011011001010011001010011001110011000110011010110011010110011010110001010110001010110001010110001010110001010110001000110001000110000000110000000110100000111100000111100000011100001011100001011100101011100101011110101011010101011010101011010101111010101111010111111010011111010011111010011111010011111010011101010011001010010001010000001010100001010100001000100001100100001100100011100100111100101111100111111100111111101111111101111111001111110001111100001111100001110100001110100001110100001110100011110100011110100011110100011110100011111100011101100011101100010101100000101100000101100000101100000101000000100000000110000000010000000010000000010000100010001100010011100010011100010011100000011100100011100100011100100011100100010100100010100100110100101110100101110100001110100001110100001110";
    const std::string cifra3bits = "011001100010101110111";

    std::string caminhoArquivoEntrada = "";
    std::cout << "\nDigite o caminho do arquivo de entrada: ";
    std::cin >> caminhoArquivoEntrada;
    std::cin.ignore();

    std::ifstream arquivoEntrada(caminhoArquivoEntrada);
    if(arquivoEntrada.fail()) {
        std::cout << "\nNao foi possivel abrir o arquivo de entrada.";
        return -1;
    }

    std::string caminhoArquivoSaida = "";
    std::cout << "\nDigite o caminho do arquivo de saida: ";
    std::cin >> caminhoArquivoSaida;
    std::cin.ignore();

    std::ofstream arquivoSaida(caminhoArquivoSaida);
    if(arquivoSaida.fail()) {
        std::cout << "\nNao foi possivel criar o arquivo de saida.";
        return -1;
    }

    arquivoSaida << "P2\n";
    arquivoSaida << "881 673\n";
    arquivoSaida << "255\n";

    unsigned int escolha = 0;
    std::cout << "\n[1] para 8 bits\n[2] para 3 bits\n";
    std::cout << "\nDigite a cifra que deseja utilizar (8 ou 3 bits): ";
    std::cin >> escolha;
    std::cin.ignore();

    std::string cifra = (escolha == 1) ? cifra8Bits : cifra3bits;

    bool bit = 0;
    bool itemAtualCifra = 0;
    unsigned int indexCifra = 0;

    unsigned int contadorCaracteresLinha = 0;
    unsigned int quantidadeMaximaCaracteresPorLinha = 64;

    while(arquivoEntrada >> bit) {
        if(indexCifra == cifra.size()) {
            indexCifra = 0;
        }

        itemAtualCifra = (cifra[indexCifra] == '1') ? 1 : 0;
        indexCifra++;
        
        bool bitCifrado = bit ^ itemAtualCifra;
        if(bitCifrado == 0) {
            arquivoSaida << " 0";
        }
        else {
            arquivoSaida << " 255";
        }

        contadorCaracteresLinha += 4;
        if(contadorCaracteresLinha >= quantidadeMaximaCaracteresPorLinha) {
            arquivoSaida << "\n";
            contadorCaracteresLinha = 0;
        }
    }

    arquivoEntrada.close();
    arquivoSaida.close();

    return 0;
}